<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="API documentation for the Rust `faketime` mod in crate `faketime`."><meta name="keywords" content="rust, rustlang, rust-lang, faketime"><title>faketime::faketime - Rust</title><link rel="stylesheet" type="text/css" href="../../normalize.css"><link rel="stylesheet" type="text/css" href="../../rustdoc.css" id="mainThemeStyle"><link rel="stylesheet" type="text/css" href="../../dark.css"><link rel="stylesheet" type="text/css" href="../../light.css" id="themeStyle"><script src="../../storage.js"></script><noscript><link rel="stylesheet" href="../../noscript.css"></noscript><link rel="shortcut icon" href="../../favicon.ico"><style type="text/css">#crate-search{background-image:url("../../down-arrow.svg");}</style></head><body class="rustdoc mod"><!--[if lte IE 8]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="sidebar"><div class="sidebar-menu">&#9776;</div><a href='../../faketime/index.html'><div class='logo-container'><img src='../../rust-logo.png' alt='logo'></div></a><p class='location'>Module faketime</p><div class="sidebar-elems"><div class="block items"><ul><li><a href="#functions">Functions</a></li><li><a href="#types">Type Definitions</a></li></ul></div><p class='location'><a href='../index.html'>faketime</a></p><script>window.sidebarCurrent = {name: 'faketime', ty: 'mod', relpath: '../'};</script><script defer src="../sidebar-items.js"></script></div></nav><div class="theme-picker"><button id="theme-picker" aria-label="Pick another theme!"><img src="../../brush.svg" width="18" alt="Pick another theme!"></button><div id="theme-choices"></div></div><script src="../../theme.js"></script><nav class="sub"><form class="search-form"><div class="search-container"><div><select id="crate-search"><option value="All crates">All crates</option></select><input class="search-input" name="search" disabled autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"></div><a id="settings-menu" href="../../settings.html"><img src="../../wheel.svg" width="18" alt="Change settings"></a></div></form></nav><section id="main" class="content"><h1 class='fqn'><span class='out-of-band'><span id='render-detail'><a id="toggle-all-docs" href="javascript:void(0)" title="collapse all docs">[<span class='inner'>&#x2212;</span>]</a></span><a class='srclink' href='../../src/faketime/faketime.rs.html#1-231' title='goto source code'>[src]</a></span><span class='in-band'>Module <a href='../index.html'>faketime</a>::<wbr><a class="mod" href=''>faketime</a></span></h1><div class='docblock'><p>Provides a method <code>unix_time</code> which returns elapsed time since <em>UNIX EPOCH</em>. The returned time
can be faked in each thread separately.</p>
<h2 id="compilation-time-switch" class="section-header"><a href="#compilation-time-switch">Compilation Time Switch</a></h2>
<p>Faketime can be disabled at compilation time to avoid runtime overhead and potential
vulnerability of manipulating the process time.</p>
<p>It is disabled via rust cfg <code>disable_faketime</code>, e.g.:</p>
<pre><code class="language-shell">RUSTFLAGS=&quot;--cfg disable_faketime&quot; cargo build
</code></pre>
<p>By default, without setting the cfg, faketime is available for all the threads.</p>
<h2 id="usage" class="section-header"><a href="#usage">Usage</a></h2>
<p>The faketime setting is per thread. If it is enabled in a thread, a file path is also
configured. The file should store the milliseconds since UNIX EPOCH. This function will first
try to read the time from this file, and fallback to the system time when an error occurs.</p>
<p>The most straightforward way to enable faketime is calling <code>faketime::enable(path)</code> in the
thread, and <code>path</code> is the configured timestamp file. It also overrides the auto-detected
settings, as mentioned below.</p>

<div class="example-wrap"><pre class="rust rust-example-rendered">
<span class="macro">assert_ne</span><span class="macro">!</span>(<span class="ident">faketime</span>::<span class="ident">unix_time</span>().<span class="ident">as_secs</span>(), <span class="number">100</span>);
<span class="kw">let</span> <span class="ident">faketime_file</span> <span class="op">=</span> <span class="ident">faketime</span>::<span class="ident">millis_tempfile</span>(<span class="number">100_000</span>).<span class="ident">expect</span>(<span class="string">&quot;create faketime file&quot;</span>);
<span class="ident">faketime</span>::<span class="ident">enable</span>(<span class="kw-2">&amp;</span><span class="ident">faketime_file</span>);
<span class="macro">assert_eq</span><span class="macro">!</span>(<span class="ident">faketime</span>::<span class="ident">unix_time</span>().<span class="ident">as_secs</span>(), <span class="number">100</span>);</pre></div>
<p>In each thread, when this function is first invoked, and neither <code>faketime::enable(path)</code> nor
<code>faketime::disable()</code> has been invoked in the thread already, it will detect whether faketime
should be enabled and which timestamp file should be used.</p>
<p>First, if the environment variable <code>FAKETIME</code> exists, faketime is enabled, and the timestamp
file path is the environment variable value.</p>

<div class="example-wrap"><pre class="rust rust-example-rendered">
<span class="kw">use</span> <span class="ident">std</span>::<span class="ident">env</span>;
<span class="kw">use</span> <span class="ident">std</span>::<span class="ident">thread</span>;

<span class="kw">let</span> <span class="ident">faketime_file</span> <span class="op">=</span> <span class="ident">faketime</span>::<span class="ident">millis_tempfile</span>(<span class="number">123_456</span>).<span class="ident">expect</span>(<span class="string">&quot;create faketime file&quot;</span>);
<span class="ident">env</span>::<span class="ident">set_var</span>(<span class="string">&quot;FAKETIME&quot;</span>, <span class="ident">faketime_file</span>.<span class="ident">as_os_str</span>());

<span class="ident">thread</span>::<span class="ident">spawn</span>(<span class="op">|</span><span class="op">|</span> <span class="macro">assert_eq</span><span class="macro">!</span>(<span class="number">123</span>, <span class="ident">faketime</span>::<span class="ident">unix_time</span>().<span class="ident">as_secs</span>()))
    .<span class="ident">join</span>()
    .<span class="ident">expect</span>(<span class="string">&quot;join thread&quot;</span>);</pre></div>
<p>If the environment variable <code>FAKETIME</code> is missing, but this thread has a name and the name
starts with <code>FAKETIME=</code> literally, faketime is also enabled, and the timestamp file is the
portion of the thread name after <code>FAKETIME=</code>.</p>

<div class="example-wrap"><pre class="rust rust-example-rendered">
<span class="kw">use</span> <span class="ident">std</span>::<span class="ident">thread</span>;

<span class="kw">let</span> <span class="ident">faketime_file</span> <span class="op">=</span> <span class="ident">faketime</span>::<span class="ident">millis_tempfile</span>(<span class="number">123_456</span>).<span class="ident">expect</span>(<span class="string">&quot;create faketime file&quot;</span>);

<span class="ident">thread</span>::<span class="ident">Builder</span>::<span class="ident">new</span>()
    .<span class="ident">name</span>(<span class="macro">format</span><span class="macro">!</span>(<span class="string">&quot;FAKETIME={}&quot;</span>, <span class="ident">faketime_file</span>.<span class="ident">display</span>()))
    .<span class="ident">spawn</span>(<span class="op">|</span><span class="op">|</span> <span class="macro">assert_eq</span><span class="macro">!</span>(<span class="number">123</span>, <span class="ident">faketime</span>::<span class="ident">unix_time</span>().<span class="ident">as_secs</span>()))
    .<span class="ident">expect</span>(<span class="string">&quot;spawn thread&quot;</span>)
    .<span class="ident">join</span>()
    .<span class="ident">expect</span>(<span class="string">&quot;join thread&quot;</span>);</pre></div>
<p>Otherwise, faketime is disabled in the thread, until it is manually enabled via
<code>faketime::enable(path)</code>.</p>

<div class="example-wrap"><pre class="rust rust-example-rendered">
<span class="kw">use</span> <span class="ident">std</span>::<span class="ident">thread</span>;

<span class="kw">let</span> <span class="ident">start</span> <span class="op">=</span> <span class="ident">faketime</span>::<span class="ident">system</span>::<span class="ident">unix_time</span>();
<span class="ident">thread</span>::<span class="ident">spawn</span>(<span class="kw">move</span> <span class="op">|</span><span class="op">|</span> <span class="macro">assert</span><span class="macro">!</span>((<span class="ident">faketime</span>::<span class="ident">unix_time</span>() <span class="op">-</span> <span class="ident">start</span>).<span class="ident">as_secs</span>() <span class="op">&lt;</span> <span class="number">60</span>))
    .<span class="ident">join</span>()
    .<span class="ident">expect</span>(<span class="string">&quot;join thread&quot;</span>);</pre></div>
<h2 id="atomic-write" class="section-header"><a href="#atomic-write">Atomic Write</a></h2>
<p>This function reads timestamp from the file when faketime is enabled. To ensure the written
content is read in a whole, it is recommended to write the file atomically. One solution is
writing to a temporary file and then moving to the target path, as implemented in
<code>faketime::write_millis(path, millis)</code>.</p>
<p>Following snippet demonstrates how to write time to file /tmp/faketime.</p>
<pre><code class="language-shell">cat 100 &gt; /tmp/faketime_
mv /tmp/faketime_ /tmp/faketime
</code></pre>
</div><h2 id='functions' class='section-header'><a href="#functions">Functions</a></h2>
<table><tr class='module-item'><td><a class="fn" href="fn.disable.html" title='faketime::faketime::disable fn'>disable</a></td><td class='docblock-short'><p>Disables faketime in current thread.</p>
</td></tr><tr class='module-item'><td><a class="fn" href="fn.enable.html" title='faketime::faketime::enable fn'>enable</a></td><td class='docblock-short'><p>Enables faketime in current thread and use the specified timestamp file.</p>
</td></tr><tr class='module-item'><td><a class="fn" href="fn.millis_tempfile.html" title='faketime::faketime::millis_tempfile fn'>millis_tempfile</a></td><td class='docblock-short'><p>Writes time into a temporary file and return the file.</p>
</td></tr><tr class='module-item'><td><a class="fn" href="fn.unix_time.html" title='faketime::faketime::unix_time fn'>unix_time</a></td><td class='docblock-short'><p>Gets elapsed time since <em>UNIX EPOCH</em>.</p>
</td></tr><tr class='module-item'><td><a class="fn" href="fn.write_millis.html" title='faketime::faketime::write_millis fn'>write_millis</a></td><td class='docblock-short'><p>Writes time as milliseconds since <em>UNIX EPOCH</em> into the specified timestamp file.</p>
</td></tr></table><h2 id='types' class='section-header'><a href="#types">Type Definitions</a></h2>
<table><tr class='module-item'><td><a class="type" href="type.Result.html" title='faketime::faketime::Result type'>Result</a></td><td class='docblock-short'><p>A specialized <a href="../result/enum.Result.html"><code>Result</code></a> type for I/O
operations.</p>
</td></tr></table></section><section id="search" class="content hidden"></section><section class="footer"></section><script>window.rootPath = "../../";window.currentCrate = "faketime";</script><script src="../../aliases.js"></script><script src="../../main.js"></script><script defer src="../../search-index.js"></script></body></html>